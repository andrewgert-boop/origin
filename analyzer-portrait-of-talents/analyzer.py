# Модуль анализа результатов "Портрет Талантов"
# Тест 1: P, A, E, I — ПОЛНОЕ СООТВЕТСТВИЕ ТЗ

from typing import List, Dict, Any

# === Шкала перевода баллов в проценты (точно по ТЗ) ===
P_A_E_I_PERCENTS = {
    0: 0.0, 1: 1.4, 2: 2.8, 3: 4.2, 4: 5.6, 5: 6.9, 6: 8.3, 7: 9.7, 8: 11.1, 9: 12.5,
    10: 13.9, 11: 15.3, 12: 16.7, 13: 18.1, 14: 19.4, 15: 20.8, 16: 22.2, 17: 23.6, 18: 25.0,
    19: 26.4, 20: 27.8, 21: 29.2, 22: 30.6, 23: 31.9, 24: 33.3, 25: 40.0, 26: 46.7, 27: 53.3,
    28: 60.0, 29: 66.7, 30: 68.41, 31: 70.17, 32: 71.92, 33: 73.68, 34: 75.43, 35: 77.19,
    36: 78.94, 37: 80.69, 38: 82.45, 39: 84.20, 40: 85.96, 41: 87.71, 42: 89.46, 43: 91.22,
    44: 92.97, 45: 94.73, 46: 96.48, 47: 98.24, 48: 100.0
}

# === Интерпретации по стилям (только поле 0 и поле 1, остальное — "Не выявлены.") ===
INTERPRETATIONS = {
    "P": {
        "low": (
            "Поле 0: Стиль \"Р\" внешне проявляется в нашей компетентности и нацеленности на успех. "
            "\"Р\" (достижение результатов) сосредоточен на текущей задаче и за относительно малое время может выполнить огромное количество работы. "
            "Он отлично умеет «тушить пожары», разгребать завалы и работать в кризисных ситуациях, что представителям других стилей дается с большим трудом.\n"
            "Поле 1: Зачастую Респондент испытывает трудности при необходимости сосредоточиться на текущих задачах, и в большинстве случаев результаты достигаются Респондентом с отставанием в сроках. "
            "Функцию производства результатов \"здесь и сейчас\" рекомендуется поместить в зону роста, выявить узкие места и предпринять действия для их разрешения. "
            "Возможно, в задачах, которые в большей степени характерны специфике деятельности, Респондент сможет проявить большую результативность.\n"
            "Поле 2: Не выявлены.\n"
            "Поле 3: Не выявлены.\n"
            "Поле 4: Не выявлены."
        ),
        "potential": (
            "Поле 0: Стиль \"Р\" внешне проявляется в нашей компетентности и нацеленности на успех. "
            "\"Р\" (достижение результатов) сосредоточен на текущей задаче и за относительно малое время может выполнить огромное количество работы. "
            "Он отлично умеет «тушить пожары», разгребать завалы и работать в кризисных ситуациях, что представителям других стилей дается с большим трудом.\n"
            "Поле 1: Зачастую Респондент испытывает трудности при необходимости сосредоточиться на текущих задачах, и в большинстве случаев результаты достигаются Респондентом с отставанием в сроках. "
            "Функцию производства результатов \"здесь и сейчас\" рекомендуется поместить в зону роста, выявить узкие места и предпринять действия для их разрешения. "
            "Возможно, в задачах, которые в большей степени характерны специфике деятельности, Респондент сможет проявить большую результативность.\n"
            "Поле 2: Не выявлены.\n"
            "Поле 3: Не выявлены.\n"
            "Поле 4: Не выявлены."
        ),
        "medium": (
            "Поле 0: Стиль \"Р\" внешне проявляется в нашей компетентности и нацеленности на успех. "
            "\"Р\" (достижение результатов) сосредоточен на текущей задаче и за относительно малое время может выполнить огромное количество работы. "
            "Он отлично умеет «тушить пожары», разгребать завалы и работать в кризисных ситуациях, что представителям других стилей дается с большим трудом.\n"
            "Поле 1: Респондент демонстрирует способность эффективно справляться с текущими задачами и достигать результатов в установленные сроки.\n"
            "Поле 2: Умение работать в условиях неопределенности, высокая работоспособность, способность быстро адаптироваться к изменяющимся условиям.\n"
            "Поле 3: Возможные негативные проявления: чрезмерная концентрация на результатах может привести к пренебрежению процессами и людьми.\n"
            "Поле 4: к P: ценит; к А: считает, что занимается ненужной бюрократией и всё усложняет; к Е: уважает их способность предвидеть развитие событий; к I: не замечает, считает склонными к излишнему общению."
        ),
        "high": (
            "Поле 0: Стиль \"Р\" внешне проявляется в нашей компетентности и нацеленности на успех. "
            "\"Р\" (достижение результатов) сосредоточен на текущей задаче и за относительно малое время может выполнить огромное количество работы. "
            "Он отлично умеет «тушить пожары», разгребать завалы и работать в кризисных ситуациях, что представителям других стилей дается с большим трудом.\n"
            "Поле 1: Респондент стабильно демонстрирует высокую результативность, эффективно достигает целей и справляется с давлением.\n"
            "Поле 2: Высокая работоспособность, способность быстро принимать решения, действовать в условиях неопределенности.\n"
            "Поле 3: Возможные негативные проявления: может игнорировать риски, пренебрегать деталями, создавать напряжённую атмосферу, демонстрировать нетерпимость к ошибкам, стремиться к контролю, что может вызывать сопротивление у других.\n"
            "Поле 4: к P: ценит; к А: считает, что занимается ненужной бюрократией и всё усложняет; к Е: уважает их способность предвидеть развитие событий; к I: не замечает, считает склонными к излишнему общению."
        )
    },
    "A": {
        "low": (
            "Поле 0: Стиль \"А\" позволяет нам все организовать и проконтролировать. "
            "Представители стиля \"Создание Систем и Процессов\" мыслят логично и последовательно, уделяя должное внимание деталям, дотошны, а иногда бывают склонны к перфекционизму. "
            "Им свойственно создавать системы и процессы, контролировать их исполнение, накапливать данные и анализировать их.\n"
            "Поле 1: Стиль А - \"Создание правил и систем\" у Респондента развит на низком уровне. Это означает, что задачи, связанные с систематизацией, структурированием, созданием правил и норм, а также их соблюдение вызывает у Респондента трудности. "
            "Рекомендуется обратить внимание на специфику будущей деятельности Респонденту в соответствии с ожиданиями компании от исследуемой позиции. "
            "Если в ней есть задачи, которые требуют проявление стиля \"А\", то следует привлечь к исполнению таких задач тех, для кого выстраивание систем, правил и процессов - сильная сторона.\n"
            "Поле 2: Не выявлены.\n"
            "Поле 3: Не выявлены.\n"
            "Поле 4: Не выявлены."
        ),
        "potential": (
            "Поле 0: Стиль \"А\" позволяет нам все организовать и проконтролировать. "
            "Представители стиля \"Создание Систем и Процессов\" мыслят логично и последовательно, уделяя должное внимание деталям, дотошны, а иногда бывают склонны к перфекционизму. "
            "Им свойственно создавать системы и процессы, контролировать их исполнение, накапливать данные и анализировать их.\n"
            "Поле 1: Стиль А - \"Создание правил и систем\" у Респондента развит на низком уровне. Это означает, что задачи, связанные с систематизацией, структурированием, созданием правил и норм, а также их соблюдение вызывает у Респондента трудности. "
            "Рекомендуется обратить внимание на специфику будущей деятельности Респонденту в соответствии с ожиданиями компании от исследуемой позиции. "
            "Если в ней есть задачи, которые требуют проявление стиля \"А\", то следует привлечь к исполнению таких задач тех, для кого выстраивание систем, правил и процессов - сильная сторона.\n"
            "Поле 2: Не выявлены.\n"
            "Поле 3: Не выявлены.\n"
            "Поле 4: Не выявлены."
        ),
        "medium": (
            "Поле 0: Стиль \"А\" позволяет нам все организовать и проконтролировать. "
            "Представители стиля \"Создание Систем и Процессов\" мыслят логично и последовательно, уделяя должное внимание деталям, дотошны, а иногда бывают склонны к перфекционизму. "
            "Им свойственно создавать системы и процессы, контролировать их исполнение, накапливать данные и анализировать их.\n"
            "Поле 1: Респондент способен создавать и поддерживать системы, процессы и правила, обеспечивать порядок.\n"
            "Поле 2: Приверженность следовать правилам. Проявлять методичность. Ориентированность на цифры, факты и аналитику.\n"
            "Поле 3: Возможные негативные проявления: форме придается больше значения, чем смыслу деятельности; происходит перегруженность бюрократическими формальностями; доминирует приверженность к порядку и правилам; снижается способность к действиям из-за чрезмерной склонности к анализу; подчиненные Респондента склонны утаивать проблемы и соглашаться с любыми решениями руководителя.\n"
            "Поле 4: к P: критикует за отсутствие внимания к деталям; к А: ценит; к Е: считает их непредсказуемыми и несущими опасность для компании, т.к. они инициаторы изменений; к I: относится с осторожностью."
        ),
        "high": (
            "Поле 0: Стиль \"А\" позволяет нам все организовать и проконтролировать. "
            "Представители стиля \"Создание Систем и Процессов\" мыслят логично и последовательно, уделяя должное внимание деталям, дотошны, а иногда бывают склонны к перфекционизму. "
            "Им свойственно создавать системы и процессы, контролировать их исполнение, накапливать данные и анализировать их.\n"
            "Поле 1: Респондент стабильно демонстрирует способность создавать и поддерживать сложные системы, процессы и правила.\n"
            "Поле 2: Всегда следует букве закона. Уделяет внимание деталям, методичен и организован. Способен предвидеть проблемы, которые повлекут за собой новые идеи. Мыслит последовательно и логично, опирается исключительно на аналитические данные. Консервативен. Стремится к управлению и принятию решений на основе данных.\n"
            "Поле 3: Возможные негативные проявления: может демонстрировать чрезмерную консервативность, сопротивляться изменениям, перегружать систему бюрократией, терять гибкость, что может тормозить инновации.\n"
            "Поле 4: к P: критикует за отсутствие внимания к деталям; к А: ценит; к Е: считает их непредсказуемыми и несущими опасность для компании, т.к. они инициаторы изменений; к I: относится с осторожностью."
        )
    },
    "E": {
        "low": (
            "Поле 0: Стиль \"E\" - это та часть нашей личности, которая готова идти на риски, способна творить и создавать новое. "
            "Представители Е стиля генерируют новые идеи, видят возможности и угрозы, являются проводниками изменений и адаптации под новые условия. "
            "Концентрация усилий на рутинных и операционных вопросах не самая их сильная сторона.\n"
            "Поле 1: Стиль Е - \"Провоцирующий изменения\" у Респондента развит на низком уровне. Это означает, что задачи, связанные с генерацией новых идей, поиском новых возможностей, внедрением инноваций, требуют от Респондента больших усилий. "
            "Рекомендуется обратить внимание на специфику будущей деятельности Респондента в соответствии с ожиданиями компании от исследуемой позиции. "
            "Если в ней есть задачи, которые требуют проявление стиля \"Е\", то следует привлечь к исполнению таких задач тех, для кого данный стиль выражен высоко или на среднем уровне.\n"
            "Поле 2: Не выявлены.\n"
            "Поле 3: Не выявлены.\n"
            "Поле 4: Не выявлены."
        ),
        "potential": (
            "Поле 0: Стиль \"E\" - это та часть нашей личности, которая готова идти на риски, способна творить и создавать новое. "
            "Представители Е стиля генерируют новые идеи, видят возможности и угрозы, являются проводниками изменений и адаптации под новые условия. "
            "Концентрация усилий на рутинных и операционных вопросах не самая их сильная сторона.\n"
            "Поле 1: Стиль Е - \"Провоцирующий изменения\" у Респондента развит на низком уровне. Это означает, что задачи, связанные с генерацией новых идей, поиском новых возможностей, внедрением инноваций, требуют от Респондента больших усилий. "
            "Рекомендуется обратить внимание на специфику будущей деятельности Респондента в соответствии с ожиданиями компании от исследуемой позиции. "
            "Если в ней есть задачи, которые требуют проявление стиля \"Е\", то следует привлечь к исполнению таких задач тех, для кого данный стиль выражен высоко или на среднем уровне.\n"
            "Поле 2: Не выявлены.\n"
            "Поле 3: Не выявлены.\n"
            "Поле 4: Не выявлены."
        ),
        "medium": (
            "Поле 0: Стиль \"E\" - это та часть нашей личности, которая готова идти на риски, способна творить и создавать новое. "
            "Представители Е стиля генерируют новые идеи, видят возможности и угрозы, являются проводниками изменений и адаптации под новые условия. "
            "Концентрация усилий на рутинных и операционных вопросах не самая их сильная сторона.\n"
            "Поле 1: Респондент может быть активным инициатором изменений, предлагать новые идеи и решения.\n"
            "Поле 2: Инициативность, готовность к риску, способность видеть возможности.\n"
            "Поле 3: Возможные негативные проявления: может демонстрировать импульсивность, не доводить начатое до конца, игнорировать практические аспекты, что может приводить к неэффективным решениям.\n"
            "Поле 4: к P: уважает за результативность; к А: считает непредсказуемым; к Е: ценит; к I: может не замечать."
        ),
        "high": (
            "Поле 0: Стиль \"E\" - это та часть нашей личности, которая готова идти на риски, способна творить и создавать новое. "
            "Представители Е стиля генерируют новые идеи, видят возможности и угрозы, являются проводниками изменений и адаптации под новые условия. "
            "Концентрация усилий на рутинных и операционных вопросах не самая их сильная сторона.\n"
            "Поле 1: Респондент стабильно демонстрирует высокую инициативность, способность генерировать идеи и внедрять изменения.\n"
            "Поле 2: Высокая инициативность, готовность к риску, способность видеть возможности, умение мотивировать других на изменения.\n"
            "Поле 3: Возможные негативные проявления: может демонстрировать чрезмерную импульсивность, не доводить начатое до конца, игнорировать риски, что может приводить к нестабильности.\n"
            "Поле 4: к P: уважает за результативность; к А: считает непредсказуемым; к Е: ценит; к I: может не замечать."
        )
    },
    "I": {
        "low": (
            "Поле 0: Стиль 'I' мы демонстрируем тогда, когда, вступая в общение с другими людьми, мы оказываем заботу и поддержку, проявляем эмпатию, содействуем обучению и развитию, выявляем и пробуем тех, кто потенциально нужен организации для разного спектра задач. "
            "Бизнес-паттерн стиля I отвечает за долгосрочное создание отношений, создание стабильности и заменимости по персоналу, выявление необходимых компетенций в определенных людях.\n"
            "Поле 1: Стиль менеджмента I - \"Создание Отношений \" развит у Респондента на низком уровне. Т.е. для решения задач, где требуется создание продуктивных коммуникационных сред, выстраивание доверительных отношений и призыв к сотрудничеству, стоит рассмотреть вариант привлечений других ресурсов или коллег, т.е. тех коллег, у кого данный стиль выражен высоко или на среднем уровне. Тем самым Респондент сможет повысить результативность собственных планов и стоящих перед ним задач.\n"
            "Поле 2: Не выявлены.\n"
            "Поле 3: Не выявлены.\n"
            "Поле 4: Не выявлены."
        ),
        "potential": (
            "Поле 0: Стиль 'I' мы демонстрируем тогда, когда, вступая в общение с другими людьми, мы оказываем заботу и поддержку, проявляем эмпатию, содействуем обучению и развитию, выявляем и пробуем тех, кто потенциально нужен организации для разного спектра задач. "
            "Бизнес-паттерн стиля I отвечает за долгосрочное создание отношений, создание стабильности и заменимости по персоналу, выявление необходимых компетенций в определенных людях.\n"
            "Поле 1: Стиль менеджмента I - \"Создание Отношений \" развит у Респондента на низком уровне. Т.е. для решения задач, где требуется создание продуктивных коммуникационных сред, выстраивание доверительных отношений и призыв к сотрудничеству, стоит рассмотреть вариант привлечений других ресурсов или коллег, т.е. тех коллег, у кого данный стиль выражен высоко или на среднем уровне. Тем самым Респондент сможет повысить результативность собственных планов и стоящих перед ним задач.\n"
            "Поле 2: Не выявлены.\n"
            "Поле 3: Не выявлены.\n"
            "Поле 4: Не выявлены."
        ),
        "medium": (
            "Поле 0: Стиль 'I' мы демонстрируем тогда, когда, вступая в общение с другими людьми, мы оказываем заботу и поддержку, проявляем эмпатию, содействуем обучению и развитию, выявляем и пробуем тех, кто потенциально нужен организации для разного спектра задач. "
            "Бизнес-паттерн стиля I отвечает за долгосрочное создание отношений, создание стабильности и заменимости по персоналу, выявление необходимых компетенций в определенных людях.\n"
            "Поле 1: Респондент заинтересован в межличностных отношениях, оказывает поддержку, проявляет эмпатию.\n"
            "Поле 2: Способность к эмпатии, забота о других, умение выстраивать долгосрочные отношения.\n"
            "Поле 3: Возможные негативные проявления: может демонстрировать чрезмерную чувствительность, избегать конфликтов, терять фокус на задачах ради поддержания гармонии.\n"
            "Поле 4: к P: относится терпимо, если они не создают конфликтов; к А: относится терпимо, если они не создают конфликтов; к Е: симпатизирует; к I: относится с подозрением, если у них больше политической власти."
        ),
        "high": (
            "Поле 0: Стиль 'I' мы демонстрируем тогда, когда, вступая в общение с другими людьми, мы оказываем заботу и поддержку, проявляем эмпатию, содействуем обучению и развитию, выявляем и пробуем тех, кто потенциально нужен организации для разного спектра задач. "
            "Бизнес-паттерн стиля I отвечает за долгосрочное создание отношений, создание стабильности и заменимости по персоналу, выявление необходимых компетенций в определенных людях.\n"
            "Поле 1: Респондент стабильно демонстрирует высокую способность к эмпатии, поддержке и развитию других.\n"
            "Поле 2: Высокая эмпатия, способность выстраивать долгосрочные отношения, умение выявлять потенциал у других.\n"
            "Поле 3: Возможные негативные проявления: может демонстрировать чрезмерную чувствительность, избегать конфликтов, терять фокус на задачах ради поддержания гармонии.\n"
            "Поле 4: к P: относится терпимо, если они не создают конфликтов; к А: относится терпимо, если они не создают конфликтов; к Е: симпатизирует; к I: относится с подозрением, если у них больше политической власти."
        )
    }
}

# === Определение уровня выраженности и индикатора ===
def get_expression_level_and_indicator(raw_score: int) -> Dict[str, str]:
    if raw_score <= 19:
        return {"level": "низкий", "indicator": "red", "category": "low"}
    elif raw_score <= 24:
        return {"level": "потенциал", "indicator": "white", "category": "potential"}
    elif raw_score <= 29:
        return {"level": "средний", "indicator": "yellow", "category": "medium"}
    else:
        return {"level": "высокий", "indicator": "green", "category": "high"}

# === Тест 1: P, A, E, I ===
def calculate_paei_scores(answers: List[Dict]) -> List[Dict]:
    p_result = a_result = e_result = i_result = 0
    for ans in answers:
        q_id = ans['question_id']
        val = ans['answer_value']
        # P1-P12
        if q_id in [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]:
            p_result += val
        # A1-A12
        elif q_id in [13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24]:
            a_result += val
        # E1-E12
        elif q_id in [25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36]:
            e_result += val
        # I1-I12
        elif q_id in [37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48]:
            i_result += val

    results = []

    # P_result
    p_level_info = get_expression_level_and_indicator(p_result)
    p_interp = INTERPRETATIONS["P"][p_level_info["category"]]
    results.append({
        "parameter_name": "P_result",
        "raw_score": p_result,
        "standardized_score": round(P_A_E_I_PERCENTS.get(p_result, 100.0), 2),
        "expression_level": p_level_info["level"],
        "indicator": p_level_info["indicator"],
        "interpretation_text": p_interp
    })

    # A_result
    a_level_info = get_expression_level_and_indicator(a_result)
    a_interp = INTERPRETATIONS["A"][a_level_info["category"]]
    results.append({
        "parameter_name": "A_result",
        "raw_score": a_result,
        "standardized_score": round(P_A_E_I_PERCENTS.get(a_result, 100.0), 2),
        "expression_level": a_level_info["level"],
        "indicator": a_level_info["indicator"],
        "interpretation_text": a_interp
    })

    # E_result
    e_level_info = get_expression_level_and_indicator(e_result)
    e_interp = INTERPRETATIONS["E"][e_level_info["category"]]
    results.append({
        "parameter_name": "E_result",
        "raw_score": e_result,
        "standardized_score": round(P_A_E_I_PERCENTS.get(e_result, 100.0), 2),
        "expression_level": e_level_info["level"],
        "indicator": e_level_info["indicator"],
        "interpretation_text": e_interp
    })

    # I_result
    i_level_info = get_expression_level_and_indicator(i_result)
    i_interp = INTERPRETATIONS["I"][i_level_info["category"]]
    results.append({
        "parameter_name": "I_result",
        "raw_score": i_result,
        "standardized_score": round(P_A_E_I_PERCENTS.get(i_result, 100.0), 2),
        "expression_level": i_level_info["level"],
        "indicator": i_level_info["indicator"],
        "interpretation_text": i_interp
    })

    return results

# === Основная функция анализа ===
def analyze(assignment_id: int, answers: List[Dict]) -> List[Dict]:
    return calculate_paei_scores(answers)

##############################*************************####################################

##############################*************************####################################

# Модуль анализа результатов "Портрет Талантов"
# Тест 2: Эмоциональный интеллект — ПОЛНОЕ СООТВЕТСТВИЕ ТЗ

from typing import List, Dict, Any

# === Шкала для компетенций (0–18 баллов) ===
EI_PERCENTS = {
    0: 0.0, 1: 4.76, 2: 9.52, 3: 14.28, 4: 19.05, 5: 23.81, 6: 28.57,
    7: 33.33, 8: 38.89, 9: 44.44, 10: 50.00, 11: 55.55, 12: 61.11,
    13: 66.66, 14: 73.33, 15: 80.00, 16: 86.66, 17: 93.33, 18: 100.0
}

# === Шкала для общего уровня EI (0–90 баллов) ===
TOTAL_EI_PERCENTS = {i: min(round((i / 90.0) * 100, 2), 100.0) for i in range(91)}

# === Интерпретации по компетенциям (дословно из ТЗ) ===
INTERPRETATIONS = {
    "emotional_awareness": {
        "low": "Эмоциональная осведомленность Респондента развита на низком уровне. Это может служить помехой в релевантной оценке Респондентом своих сильных сторон и ограничений, т.к. только в меньшей половине случаев Респонденту удается осознать свои эмоции и идентифицировать их причину. Рекомендуется рассматривать эту область как зону роста для Респондента.",
        "medium": "Эмоциональная осведомленность Респондента развита на среднем уровне. Это означает, что Респонденту не всегда удается осознавать свои эмоции и их последствия. Это происходит примерно в половине случаев. Тогда когда Респонденту это удается, он может оценить свои сильные стороны и ограничения, принять взвешенное решение.",
        "high": "Эмоциональная осведомленность Респондента развита на высоком уровне. Это помогает Респонденту осознавать свои эмоции и их последствия в большинстве случаев. Благодаря этому Респондент обладаете твердым пониманием своей ценности и возможностей, знанием своих сильных сторон и ограничений, что способствует принятию взвешенных решений."
    },
    "self_management": {
        "low": "Уровень управления своими эмоциями определен исследованием как низкий. Скорее всего, Респонденту редко удается сдерживать негативные эмоции и побуждения. Проявить гибкость и открытость к переменам часто бывает для Респондента сложной задачей. Контроль интенсивности эмоций и способность к саморегуляции рекомендуется рассматривать как зону роста.",
        "medium": "Управление своими эмоциями Респондент демонстрируете на среднем уровне. Чаще удается сдерживать негативные эмоции и побуждения, но для этого приходится прилагать усилия. Бывают ситуации, когда проявление гибкости и открытости к переменам требуют от Респондента дополнительной энергии и внутренних затрат. В большинстве случаев Респондент справляетесь с этим. ",
        "high": "Респондент демонстрирует высокий уровень навыка управления своими эмоциями. Это помогает сдерживать разрушительные эмоции и побуждения. Определяет готовность Респондентом нести ответственность за свою работу и проявлять гибкость, позволяет более спокойно относится к новой информации и переменам."
    },
    "self_motivation": {
        "low": "Уровень самомотивации Респондента определен исследованием как низкий. Это может выступать ограничением при необходимости взяться за новое дело, знания или вернуться к тому, что не получается. Внутренние переживания могут мешать вдохновлять себя и других при работе с чем-то сложным. Рекомендуется посмотреть на самомотивацию как на зону роста Респондента.",
        "medium": "Респондент демонстрирует проявление самомотивации на среднем уровне. Респондент готов проявлять стремление к достижению целей, иногда тратя время на переживания, связанные с неудачами больше, чем хотелись бы. При этом Респондент не теряет способность к самовосстановлению и самомотивации для новых дел.",
        "high": "Уровень самомотивации Респондента определен исследованием как высокий. Готовность действовать в соответствии с возможностями, настойчивость в достижении целей - сильная сторона Респондента. Способность переживать неудачи легче чем другие, воспринимать их как опыт - то, что помогает Респонденту не сворачивать с намеченного пути."
    },
    "empathy": {
        "low": "Результаты исследования по эмпатии позволяют рекомендовать рассматривать область эмпатии как зону роста для Респондента, т.к. выраженность развития низкая. Понимание проявления эмоций и поведения других людей, причинно-следственная связь между эмоцией человека и его потребностью является для Респондента часто сложной задачей. Этот фактор может ограничивать Респондента в установлении эффективного взаимодействия.",
        "medium": "По результатам исследования Респондент продемонстрировал средний уровень эмпатии. Это выражается в способности понимать эмоции и потребности других в большинстве случаев. При этом Респондент может сталкиваться с трудностями в предугадывании и проактивной подстройке под потребности близких, коллег, клиентов. Респондент может поддерживать и развивать отношения с другими на необходимом, качественном уровне.",
        "high": "Результаты исследования говорят о высоком уровне эмпатии у Респондента. Респондент тонко чувствует эмоции и потребности других. Демонстрирует присоединение и оказывает поддержку людям, когда они в ней нуждаются. Эта способность помогает предугадывать потребности близких, коллег, клиентов и способствует благоприятному взаимодействию и развитию отношений и потенциала других."
    },
    "social_skills": {
        "low": "Способности вызывать у других желательные для Респондента реакции развиты на низком уровне. Респонденту тяжело дается понимание о причинах эмоционального состояния других. В связи с этим, сформировать стратегию взаимодействия с другими, с целью объединения усилий для достижения общих коллективных целей дается Респонденту с трудом.",
        "medium": "Способности вызывать у других желательную для Респондента реакцию развиты на среднем уровне. Часто Респонденту удается действовать с позиции учета интересов сторон. При приложении дополнительных усилий, Респондент способен вдохновлять других, выступать инициатором изменений ради достижения общих целей. Респондент обладает способностью понимать состояние других людей и корректировать в связи с этим свои действия.",
        "high": "Респондент демонстрирует высокий уровень способностей воздействия на эмоциональное состояние других людей по результатам исследования. Это позволяет Респонденту действовать с позиции интересов обеих сторон, убедительно, минимизируя возможные конфликты. Способность воодушевлять, создавать групповую синергию и выступать инициатором перемен - эти навыки могут быть сильными сторонами Респондента."
    },
    "total_ei": {
        "low": "По результатам совокупных данных исследования уровень эмоционального интеллекта Респондента определяется как низкий. Скорее всего Респонденту тяжело дается справляться с негативными эмоциями, стрессом. Также может быть сложно понимать поступки и эмоции других людей, выстраивать причинно-следственные связи между реакциями людей и их поведением. Развитие эмоционального интеллекта позволит сделать более комфортным качество взаимодействия с другими людьми, повысить общий комфорт жизни и удовлетворённость Респондента от взаимодействия.",
        "medium": "По результатам совокупных данных исследования уровень эмоционального интеллекта Респондента определяется как средний. В большинстве случаев Респондент проявляете способность устанавливать и развивать эффективные отношения с людьми, способен влиять на ситуации в пользу необходимого результата. Иногда это требует от Респондента больше усилий и времени, чем бы он сам того хотел. Обратите внимание на отдельные Вопроси ЭИ, где уровень низкий или средний, возможно, если обратить их в зону роста Респондент сможет повысить свою удовлетворенность от результатов взаимодействия с людьми.",
        "high": "По результатам совокупных данных исследования уровень эмоционального интеллекта Респондента определяется как высокий. Чаще всего Респондент осознанно подходит к принятию решений и может выстраивать причинно-следственные связи между эмоциями людей и их поведением. В большинстве случаев Респондент легко контактирует с людьми и выстраивает эффективное взаимодействие. Демонстрирует понимание потребностей других и может подстроиться, оказать поддержку. Может действовать убедительно и эффективно взаимодействовать в команде ради общей цели или взаимовыгодного результата."
    }
}

# === Определение уровня выраженности и индикатора ===
def get_level_and_indicator(score: int) -> Dict[str, str]:
    if score <= 7:
        return {"level": "низкий", "indicator": "red", "category": "low"}
    elif score <= 13:
        return {"level": "средний", "indicator": "yellow", "category": "medium"}
    else:
        return {"level": "высокий", "indicator": "green", "category": "high"}

# === Тест 2: Эмоциональный интеллект ===
def calculate_emotional_intelligence_scores(answers: List[Dict]) -> List[Dict]:
    # Сопоставление: question_id -> answer_value
    q_mapping = {ans['question_id']: ans['answer_value'] for ans in answers}

    # Расчёт баллов по компетенциям
    emotional_awareness = sum(q_mapping.get(q, 0) for q in [1, 2, 4, 17, 19, 25])
    self_management = sum(q_mapping.get(q, 0) for q in [3, 7, 8, 10, 18, 30])
    self_motivation = sum(q_mapping.get(q, 0) for q in [5, 6, 13, 14, 16, 22])
    empathy = sum(q_mapping.get(q, 0) for q in [9, 11, 20, 21, 23, 28])
    social_skills = sum(q_mapping.get(q, 0) for q in [12, 15, 24, 26, 27, 29])

    # Общий уровень EI
    total_ei = emotional_awareness + self_management + self_motivation + empathy + social_skills

    results = []

    # Добавляем каждую компетенцию
    for score, key in [
        (emotional_awareness, "emotional_awareness"),
        (self_management, "self_management"),
        (self_motivation, "self_motivation"),
        (empathy, "empathy"),
        (social_skills, "social_skills")
    ]:
        level_info = get_level_and_indicator(score)
        percentage = EI_PERCENTS.get(score, 100.0)
        interpretation = INTERPRETATIONS[key][level_info["category"]]

        results.append({
            "parameter_name": key,
            "raw_score": score,
            "standardized_score": round(percentage, 2),
            "expression_level": level_info["level"],
            "indicator": level_info["indicator"],
            "interpretation_text": interpretation
        })

    # Добавляем общий уровень EI
    total_level_info = get_level_and_indicator(total_ei)
    total_percentage = TOTAL_EI_PERCENTS.get(total_ei, 100.0)
    total_interpretation = INTERPRETATIONS["total_ei"][total_level_info["category"]]

    results.append({
        "parameter_name": "total_emotional_intelligence",
        "raw_score": total_ei,
        "standardized_score": round(total_percentage, 2),
        "expression_level": total_level_info["level"],
        "indicator": total_level_info["indicator"],
        "interpretation_text": total_interpretation
    })

    return results

#********** *** *** *** ***
#********** ***
#*********  ****

# Модуль анализа результатов "Портрет Талантов"
# Тест 3: Командные роли — ПОЛНОЕ СООТВЕТСТВИЕ ТЗ (дословно)



# === Шкалы перевода баллов в проценты (для каждой роли — отдельно, как в ТЗ) ===

TEAM_ROLE_PERCENTS = {
    'Im': {
        0: 0.0, 1: 4.0, 2: 8.0, 3: 13.0, 4: 17.0, 5: 21.0, 6: 25.0, 7: 30.0, 8: 35.0,
        9: 40.0, 10: 45.0, 11: 50.0, 12: 55.0, 13: 60.0, 14: 65.0, 15: 70.0, 16: 75.0,
        17: 79.0, 18: 82.0, 19: 86.0, 20: 89.0, 21: 93.0, 22: 96.0, 23: 100.0, 24: 100.0,
        25: 100.0, 26: 100.0, 27: 100.0, 28: 100.0, 29: 100.0, 30: 100.0, 31: 100.0,
        32: 100.0, 33: 100.0, 34: 100.0, 35: 100.0
    },
    'CO': {
        0: 0.0, 1: 4.0, 2: 8.0, 3: 13.0, 4: 17.0, 5: 21.0, 6: 25.0, 7: 31.0, 8: 38.0,
        9: 44.0, 10: 50.0, 11: 58.0, 12: 67.0, 13: 75.0, 14: 80.0, 15: 85.0, 16: 90.0,
        17: 95.0, 18: 100.0
    },
    'Sh': {
        0: 0.0, 1: 3.0, 2: 6.0, 3: 9.0, 4: 13.0, 5: 16.0, 6: 19.0, 7: 22.0, 8: 25.0,
        9: 30.0, 10: 35.0, 11: 40.0, 12: 45.0, 13: 50.0, 14: 56.0, 15: 63.0, 16: 69.0,
        17: 75.0, 18: 76.0, 19: 78.0, 20: 79.0, 21: 80.0, 22: 82.0, 23: 83.0, 24: 84.0,
        25: 86.0, 26: 87.0, 27: 88.0, 28: 89.0, 29: 91.0, 30: 92.0, 31: 93.0, 32: 95.0,
        33: 96.0, 34: 97.0, 35: 99.0, 36: 100.0
    },
    'Pl': {
        0: 0.0, 1: 6.0, 2: 13.0, 3: 19.0, 4: 25.0, 5: 31.0, 6: 38.0, 7: 44.0, 8: 50.0,
        9: 56.0, 10: 63.0, 11: 69.0, 12: 75.0, 13: 76.0, 14: 78.0, 15: 79.0, 16: 81.0,
        17: 82.0, 18: 84.0, 19: 85.0, 20: 87.0, 21: 88.0, 22: 90.0, 23: 91.0, 24: 93.0,
        25: 94.0, 26: 96.0, 27: 97.0, 28: 99.0, 29: 100.0
    },
    'RI': {
        0: 0.0, 1: 4.0, 2: 8.0, 3: 13.0, 4: 17.0, 5: 21.0, 6: 25.0, 7: 33.0, 8: 42.0,
        9: 50.0, 10: 63.0, 11: 75.0, 12: 78.0, 13: 80.0, 14: 83.0, 15: 85.0, 16: 88.0,
        17: 90.0, 18: 93.0, 19: 95.0, 20: 98.0, 21: 100.0
    },
    'ME': {
        0: 0.0, 1: 5.0, 2: 10.0, 3: 15.0, 4: 20.0, 5: 25.0, 6: 31.0, 7: 38.0, 8: 44.0,
        9: 50.0, 10: 58.0, 11: 67.0, 12: 75.0, 13: 79.0, 14: 82.0, 15: 86.0, 16: 89.0,
        17: 93.0, 18: 96.0, 19: 100.0
    },
    'TW': {
        0: 0.0, 1: 3.0, 2: 6.0, 3: 9.0, 4: 13.0, 5: 16.0, 6: 19.0, 7: 22.0, 8: 25.0,
        9: 31.0, 10: 38.0, 11: 44.0, 12: 50.0, 13: 56.0, 14: 63.0, 15: 69.0, 16: 75.0,
        17: 78.0, 18: 81.0, 19: 83.0, 20: 86.0, 21: 89.0, 22: 92.0, 23: 94.0, 24: 97.0,
        25: 100.0
    },
    'CF': {
        0: 0.0, 1: 8.0, 2: 17.0, 3: 25.0, 4: 33.0, 5: 42.0, 6: 50.0, 7: 58.0, 8: 67.0,
        9: 75.0, 10: 78.0, 11: 81.0, 12: 84.0, 13: 88.0, 14: 91.0, 15: 94.0, 16: 97.0,
        17: 100.0
    }
}

# === Интерпретации по ролям (дословно из ТЗ) ===
INTERPRETATIONS = {
    "Im": {
        "low": (
            "Поле 1\n"
            "Респонденту свойственно воплощать идеи и планы в жизнь, реализовывать задачи и решения не задействовав свои собственные ресурсы. Склонен больше вовлекать ресурсы других коллег. Брать эту роль в план для развития Респондента или нет, зависит от  ожиданий компании по профилю должности.\n"
            "Поле 2\n"
            "Не выявлены.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "medium": (
            "Поле 1\n"
            "Респондент демонстрирует достаточный уровень специальных знаний в той области, которой занимается. Осуществляет качественную реализацию задач, стоящих перед Респондентом, в редких случаях нуждается в поддержке руководителя или коллег для реализации намеченного.\n"
            "Поле 2\n"
            "Респондент может демонстрировать практичность, надежность и эффективность при выполнении задач. Успешно выступить в роли реализатора идей и планов, организовать работу.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "high": (
            "Поле 1\n"
            "Респондент хорошо и качественно реализует разработанную тактику, порученные ему задачи. Проявляет высокий уровень экспертизы в той деятельности, которой занимается. Стремится к получению знаний в своей профессиональной области.\n"
            "Поле 2\n"
            "Практичность, надежность, эффективность. Качественная реализация идей и планов. Исполнение поставленных задач перед Респондентом.\n"
            "Поле 3\n"
            "Респондент может быть негибким и медленно реагировать на возможности, тяжело относится к изменениям и теряться в \"острых\" ситуациях."
        ),
        "very_high": (
            "Поле 1\n"
            "Респондент хорошо и качественно реализует разработанную тактику, порученные ему задачи. Проявляет высокий уровень экспертизы в той деятельности, которой занимается. Стремится к получению знаний в своей профессиональной области.\n"
            "Поле 2\n"
            "Практичность, надежность, эффективность. Качественная реализация идей и планов. Исполнение поставленных задач перед Респондентом.\n"
            "Поле 3\n"
            "Респондент может слишком часто проявлять негибкость и медленно реагировать на возможности, тяжело относится к изменениям и теряется в \"острых\" ситуациях."
        )
    },
    "CO": {
        "low": (
            "Поле 1\n"
            "Управление ресурсами и их распределение, координация людей в рамках выполнения задач, оценка потенциала ресурсов - не самая сильная сторона Респондента. Брать эту роль в план для развития или нет, зависит от того, какая конкретная роль в команде ожидается по профилю должности.\n"
            "Поле 2\n"
            "Не выявлены.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "medium": (
            "Поле 1\n"
            "Респонденту свойственно брать на себя функции управления командой для достижения поставленных целей - вовлекать членов команды в работу, делегировать задачи, распределять ресурсы и управлять ими.\n"
            "Поле 2\n"
            "Респондент может демонстрировать необходимую скорость в принятии решений, навыки в области делегирования полномочий и эффективного распределения ресурсов.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "high": (
            "Поле 1\n"
            "Респондент сосредоточен на целях команды, вовлечении коллег в работу и делегировании задач. Понимает сильные и слабые стороны команды, обладаете навыками эффективного распределения ресурсов и управления ими.\n"
            "Поле 2\n"
            "Зрелость, уверенность в себе, определение талантов, скорость в принятии решений, делегирование полномочий.\n"
            "Поле 3\n"
            "Респондент иногда склонен к манипулированию и периодически может перекладывать свой личный объем работы на других."
        ),
        "very_high": (
            "Поле 1\n"
            "Респондент сосредоточен на целях команды, вовлечении коллег в работу и делегировании задач. Понимает сильные и слабые стороны команды, обладаете навыками эффективного распределения ресурсов и управления ими.\n"
            "Поле 2\n"
            "Зрелость, уверенность в себе, определение талантов, скорость в принятии решений, делегирование полномочий.\n"
            "Поле 3\n"
            "Респондент обладает повышенной склонностью к манипулированию и может перекладывать свой личный объем работы на других."
        )
    },
    "Sh": {
        "low": (
            "Поле 1\n"
            "Респондент не демонстрирует способности к мотивации и вдохновению членов команды на достижение поставленных целей в долгосрочной перспективе. Может демонстрировать снижение темпа работы в сложных для Респондента ситуациях. Брать эту роль в план для развития или нет, зависит от профиля должности.\n"
            "Поле 2\n"
            "Не выявлены.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "medium": (
            "Поле 1\n"
            "Респонденту чаще удается обеспечить необходимый драйв, чтобы команда продолжала двигаться к цели и не теряла сосредоточенность и импульс. Респондент способен мотивировать членов команды, разъяснять цели и расставлять приоритеты.\n"
            "Поле 2\n"
            "Респондент способен проявить динамичность, напористость, смелость в преодолении препятствий и стрессоустойчивость при давлении обстоятельств.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "high": (
            "Поле 1\n"
            "Респондент обеспечивает необходимый драйв, чтобы команда продолжала двигаться к цели и не теряла сосредоточенность и импульс. Респондент мотивирует коллег, разъясняет цели и расставляет приоритеты.\n"
            "Поле 2\n"
            "Динамичность, напористость, смелость в преодолении препятствий, стрессоустойчивость при давлении обстоятельств.\n"
            "Поле 3\n"
            "Респондент может проявлять склонность к провокациям, иногда демонстрировать агрессивность и раздражительность на пути к цели."
        ),
        "very_high": (
            "Поле 1\n"
            "Респондент обеспечивает необходимый драйв, чтобы команда продолжала двигаться к цели и не теряла сосредоточенность и импульс. Респондент мотивирует коллег, разъясняет цели и расставляет приоритеты.\n"
            "Поле 2\n"
            "Динамичность, напористость, смелость в преодолении препятствий, стрессоустойчивость при давлении обстоятельств.\n"
            "Поле 3\n"
            "Респондент может часто проявлять склонность к провокациям, иногда демонстрировать агрессивность и раздражительность на пути к цели."
        )
    },
    "Pl": {
        "low": (
            "Поле 1\n"
            "Респондент испытывает затруднения, когда требуется проявить креативный или творческий подход, создать что-то новое с \"0\", выполнять роль генератора идей в команде - не самая сильная сторона Респондента. Брать эту роль в план для развития или нет, зависит от того, какие ожидания у компании по профилю должности.\n"
            "Поле 2\n"
            "Не выявлены.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "medium": (
            "Поле 1\n"
            "Респондент склонен демонстрировать нестандартный подход к решению проблемных задач, предлагать новые способы и инструменты для достижения результата, если того требуют обстоятельства.\n"
            "Поле 2\n"
            "Респондент иногда способен проявить креативность, образное мышление и воображение при решении сложных задач.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "high": (
            "Поле 1\n"
            "Респондент креативен и умеет решать проблемы нестандартным способом. Предлагает новые подходы и решения для задач. Умеет видеть и выделять возможности, там где другие их не видят.\n"
            "Поле 2\n"
            "Креативность, развитое образное мышление и воображение, свободомыслие, склонность к решению сложных задач.\n"
            "Поле 3\n"
            "Респондент может игнорировать важные детали и текущие обстоятельства. Увлеченность идеями может препятствовать эффективным коммуникациям с коллегами."
        ),
        "very_high": (
            "Поле 1\n"
            "Респондент креативен и часто решает проблемы нестандартным способом. Предлагает новые подходы и решения для задач. Умеет видеть и выделять возможности, генерирует идеи.\n"
            "Поле 2\n"
            "Креативность, развитое образное мышление и воображение, свободомыслие, склонность к решению сложных задач.\n"
            "Поле 3\n"
            "Респондент может игнорировать важные детали и текущие обстоятельства. Увлеченность идеями может препятствовать эффективным коммуникациям с коллегами."
        )
    },
    "RI": {
        "low": (
            "Поле 1\n"
            "Формирование устойчивых внешних коммуникаций, сбор идей и информации во внешней среде - инструмент который Респондент практически не использует в силу низкого развития этого навыка. Брать эту роль в план для развития или нет, зависит от того, какую конкретно роль в команде ожидается от профиля должности.\n"
            "Поле 2\n"
            "Не выявлены.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "medium": (
            "Поле 1\n"
            "Респондент владеет навыком поиска идей, информации и ресурсов во внешней среде, которые могут усилить команду для достижения целей. Респондент способен обеспечить устойчивые внешние коммуникации.\n"
            "Поле 2\n"
            "Респондент способен проявлять коммуникабельность, энтузиазм, любознательность,  демонстрировать развитые навыки переговорщика.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "high": (
            "Поле 1\n"
            "Респондент обеспечивает поиск идей, информации и ресурсов во внешней среде, которые могут усилить команду для достижения целей. Респондент строит сети контактов и обеспечиваете устойчивые внешние коммуникации.\n"
            "Поле 2\n"
            "Коммуникабельность, энтузиазм, любознательность, использование новых возможностей, высоко развитые навыки переговорщика.\n"
            "Поле 3\n"
            "Респондент может быть чрезмерно оптимистично настроен и теряет интерес, когда первоначальный энтузиазм команды иссякнет."
        ),
        "very_high": (
            "Поле 1\n"
            "Респондент обеспечивает поиск идей, информации и ресурсов во внешней среде, которые могут усилить команду для достижения целей. Респондент строит сети контактов и обеспечиваете устойчивые внешние коммуникации.\n"
            "Поле 2\n"
            "Коммуникабельность, энтузиазм, любознательность, использование новых возможностей, высоко развитые навыки переговорщика.\n"
            "Поле 3\n"
            "Респондент может быть чрезмерно оптимистично настроен и теряет интерес, когда первоначальный энтузиазм команды иссякнет."
        )
    },
    "ME": {
        "low": (
            "Поле 1\n"
            "Респондент может испытывать сложности, когда требуется критически оценить ситуацию, взвесив ее плюсы и минусы или когда необходимо проявить себя в анализе массивов данных и выдать критическое суждение и оценку.\n"
            "Поле 2\n"
            "Не выявлены.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "medium": (
            "Поле 1\n"
            "В некоторых случаях Респондент может обеспечить логический подход при решении задач команды, сделать беспристрастные суждения там, где это необходимо. Объективно проанализировать варианты действий команды.\n"
            "Поле 2\n"
            "Респондент может продемонстрировать объективность, стратегичность, проницательность и развитые аналитические способности.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "high": (
            "Поле 1\n"
            "Респондент обеспечивает логический подход при решении задач, делает беспристрастные суждения там, где это необходимо. Объективно анализирует варианты действий, критически может посмотреть на ситуацию.\n"
            "Поле 2\n"
            "Объективность, стратегичность, проницательность, развитые аналитические способности.\n"
            "Поле 3\n"
            "Иногда Респонденту не хватает драйва и способности вдохновлять других, может медленно принимать решения. В некоторых ситуациях Респондент может быть чрезмерно критичен."
        ),
        "very_high": (
            "Поле 1\n"
            "Респондент обеспечивает логический подход при решении задач, делает беспристрастные суждения там, где это необходимо. Объективно и глубоко анализирует варианты действий, критически может посмотреть на ситуацию.\n"
            "Поле 2\n"
            "Объективность, стратегичность, проницательность, развитые аналитические способности.\n"
            "Поле 3\n"
            "Часто Респонденту не хватает драйва и способности вдохновлять других, может медленно принимать решения. В некоторых ситуациях Респондент может быть чрезмерно критичен."
        )
    },
    "TW": {
        "low": (
            "Поле 1\n"
            "Респондент мало интересуется о том, как идут  дела у членов команды,  что бы помочь в их решении и присоединиться к проблеме. Создание атмосферы дружелюбия в коллективе мало занимает Респондента, предпочитает тратить усилия на другие области деятельности.\n"
            "Поле 2\n"
            "Не выявлены.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "medium": (
            "Поле 1\n"
            "В большинстве случаев Респондент выступает в роли сотрудника, который  помогает команде объединиться, налаживает взаимодействие и сотрудничество среди коллег, проявляет заботу об окружающих.\n"
            "Поле 2\n"
            "Респондент может демонстрировать готовность к сотрудничеству, восприимчивость и дипломатичность при общении с коллегами.  Может предотвращать трения и конфликты в команде.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "high": (
            "Поле 1\n"
            "Респондент помогает команде объединиться, играет поддерживающую роль, ориентированную на отношения. Улучшает межличностное общение и сводит к минимуму конфликты в команде, проявляя высокий уровень заботы о ее членах.\n"
            "Поле 2\n"
            "Готовность к сотрудничеству, восприимчивость и дипломатичность.  Предотвращение трений и конфликтов.\n"
            "Поле 3\n"
            "Респондент может быть нерешительным в кризисных ситуациях и склонен избегать любой конфронтации. Может избегать принимать непопулярные решения для команды."
        ),
        "very_high": (
            "Поле 1\n"
            "Респондент помогает команде объединиться, играет поддерживающую роль, ориентированную на отношения. Улучшает межличностное общение и сводит к минимуму конфликты в команде, проявляя высокий уровень заботы о ее членах.\n"
            "Поле 2\n"
            "Готовность к сотрудничеству, восприимчивость и дипломатичность.  Предотвращение трений и конфликтов.\n"
            "Поле 3\n"
            "Респондент может быть нерешительным в кризисных ситуациях и склонен избегать любой конфронтации. Будет избегать принимать непопулярные решения для команды."
        )
    },
    "CF": {
        "low": (
            "Поле 1\n"
            "Респондент склонен не обращать внимания на детали и частности, мелкие ошибки и неточности. Бывают ситуации, когда начатое Респондентом дело может быть не доведено до финала. Рекомендуется принять это внимание и усилить это свойство за счет других членов команды.\n"
            "Поле 2\n"
            "Не выявлены.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "medium": (
            "Поле 1\n"
            "В большинстве случае Респондент демонстрирует стремление к обеспечению тщательного и своевременного выполнения задач в команде - проверить работы на предмет ошибок, применяя самые высокие стандарты контроля качества.\n"
            "Поле 2\n"
            "Респондент может проявлять прилежность и сознательность при поиске ошибок и недоработок, довести до совершенства результаты работы.\n"
            "Поле 3\n"
            "Не выявлены."
        ),
        "high": (
            "Поле 1\n"
            "Респондент обеспечивает тщательное и своевременное выполнение задач, которыми занимается. Проверяет результаты на предмет ошибок, применяя самые высокие стандарты контроля качества. Стремится к идеалу в том, что делает.\n"
            "Поле 2\n"
            "Прилежность, сознательность, поиск ошибок. \"Полировка\" и доведение до совершенства результатов работы.\n"
            "Поле 3\n"
            "Респонденту свойственна склонность к чрезмерному беспокойству. Периодически может избегать делегировать полномочия."
        ),
        "very_high": (
            "Поле 1\n"
            "Респондент обеспечивает тщательное и своевременное выполнение задач, которыми занимается. Проверяет результаты на предмет ошибок, применяя самые высокие стандарты контроля качества. Стремится к идеалу в том, что делает.\n"
            "Поле 2\n"
            "Прилежность, сознательность, поиск ошибок. \"Полировка\" и доведение до совершенства результатов работы.\n"
            "Поле 3\n"
            "Респонденту свойственна склонность к чрезмерному беспокойству. Периодически может избегать делегировать полномочия."
        )
    }
}

# === Определение уровня выраженности и индикатора для каждой роли ===
def get_level_and_indicator(role: str, score: int) -> Dict[str, str]:
    if role == "Im":
        if score <= 6:
            return {"level": "низкий", "indicator": "red", "category": "low"}
        elif score <= 11:
            return {"level": "средний", "indicator": "yellow", "category": "medium"}
        elif score <= 16:
            return {"level": "высокий", "indicator": "green", "category": "high"}
        else:
            return {"level": "очень высокий", "indicator": "blue", "category": "very_high"}
    elif role == "CO":
        if score <= 6:
            return {"level": "низкий", "indicator": "red", "category": "low"}
        elif score <= 10:
            return {"level": "средний", "indicator": "yellow", "category": "medium"}
        elif score <= 13:
            return {"level": "высокий", "indicator": "green", "category": "high"}
        else:
            return {"level": "очень высокий", "indicator": "blue", "category": "very_high"}
    elif role == "Sh":
        if score <= 8:
            return {"level": "низкий", "indicator": "red", "category": "low"}
        elif score <= 13:
            return {"level": "средний", "indicator": "yellow", "category": "medium"}
        elif score <= 17:
            return {"level": "высокий", "indicator": "green", "category": "high"}
        else:
            return {"level": "очень высокий", "indicator": "blue", "category": "very_high"}
    elif role == "Pl":
        if score <= 4:
            return {"level": "низкий", "indicator": "red", "category": "low"}
        elif score <= 8:
            return {"level": "средний", "indicator": "yellow", "category": "medium"}
        elif score <= 12:
            return {"level": "высокий", "indicator": "green", "category": "high"}
        else:
            return {"level": "очень высокий", "indicator": "blue", "category": "very_high"}
    elif role == "RI":
        if score <= 6:
            return {"level": "низкий", "indicator": "red", "category": "low"}
        elif score <= 9:
            return {"level": "средний", "indicator": "yellow", "category": "medium"}
        elif score <= 11:
            return {"level": "высокий", "indicator": "green", "category": "high"}
        else:
            return {"level": "очень высокий", "indicator": "blue", "category": "very_high"}
    elif role == "ME":
        if score <= 5:
            return {"level": "низкий", "indicator": "red", "category": "low"}
        elif score <= 9:
            return {"level": "средний", "indicator": "yellow", "category": "medium"}
        elif score <= 11:
            return {"level": "высокий", "indicator": "green", "category": "high"}
        else:
            return {"level": "очень высокий", "indicator": "blue", "category": "very_high"}
    elif role == "TW":
        if score <= 8:
            return {"level": "низкий", "indicator": "red", "category": "low"}
        elif score <= 12:
            return {"level": "средний", "indicator": "yellow", "category": "medium"}
        elif score <= 16:
            return {"level": "высокий", "indicator": "green", "category": "high"}
        else:
            return {"level": "очень высокий", "indicator": "blue", "category": "very_high"}
    elif role == "CF":
        if score <= 3:
            return {"level": "низкий", "indicator": "red", "category": "low"}
        elif score <= 6:
            return {"level": "средний", "indicator": "yellow", "category": "medium"}
        elif score <= 9:
            return {"level": "высокий", "indicator": "green", "category": "high"}
        else:
            return {"level": "очень высокий", "indicator": "blue", "category": "very_high"}
    else:
        return {"level": "неизвестный", "indicator": "white", "category": "unknown"}

# === Тест 3: Командные роли ===
def calculate_team_roles_scores(answers: List[Dict]) -> List[Dict]:
    # Собираем ответы: question_id -> { "B1": 2, "B2": 0, ..., "B8": 1 }
    role_answers = {}
    for ans in answers:
        q_id = ans['question_id']
        if 97 <= q_id <= 104:  # Вопросы B-N (97-104)
            role_answers[q_id] = ans['answer_value']  # {"B1": 2, "B2": 0, ...}

    roles = {
        "Im": ["B7", "D1", "F8", "H4", "J2", "L6", "N5"],
        "CO": ["B4", "D2", "F1", "H8", "J6", "L3", "N7"],
        "Sh": ["B6", "D5", "F3", "H2", "J4", "L7", "N1"],
        "Pl": ["B3", "D7", "F4", "H5", "J8", "L1", "N6"],
        "RI": ["B1", "D3", "F6", "H7", "J5", "L8", "N4"],
        "ME": ["B8", "D4", "F7", "H3", "J1", "L5", "N2"],
        "TW": ["B2", "D6", "F5", "H1", "J3", "L2", "N8"],
        "CF": ["B5", "D8", "F2", "H6", "J7", "L4", "N3"]
    }

    results = []
    for role, fields in roles.items():
        score = 0
        for field in fields:
            for q_answers in role_answers.values():
                if field in q_answers:
                    score += q_answers[field]
        
        level_info = get_level_and_indicator(role, score)
        percentage = TEAM_ROLE_PERCENTS[role].get(score, 100.0)
        interpretation = INTERPRETATIONS[role][level_info["category"]]

        results.append({
            "parameter_name": role,
            "raw_score": score,
            "standardized_score": round(percentage, 2),
            "expression_level": level_info["level"],
            "indicator": level_info["indicator"],
            "interpretation_text": interpretation
        })

    return results

# === Основная функция анализа ===
def analyze(assignment_id: int, answers: List[Dict]) -> List[Dict]:
    # Сначала Тест 1 (P, A, E, I)
    results = calculate_paei_scores(answers)
    # Затем Тест 2 (Эмоциональный интеллект)
    results.extend(calculate_emotional_intelligence_scores(answers))
    # Теперь Тест 3 (Командные роли)
    results.extend(calculate_team_roles_scores(answers))
    return results

######

######

######

# Модуль анализа результатов "Портрет Талантов"
# Тест 4: Мотивация — ПОЛНОЕ СООТВЕТСТВИЕ ТЗ (дословно)

# === Шкала перевода баллов в проценты (0–35 баллов) ===
SCORE_TO_PERCENT = {
    0: 0.0, 1: 4.0, 2: 7.0, 3: 11.0, 4: 14.0, 5: 18.0, 6: 21.0, 7: 25.0,
    8: 30.0, 9: 35.0, 10: 40.0, 11: 45.0, 12: 50.0, 13: 56.0, 14: 63.0,
    15: 69.0, 16: 75.0, 17: 76.0, 18: 78.0, 19: 79.0, 20: 80.0,
    21: 82.0, 22: 83.0, 23: 84.0, 24: 86.0, 25: 87.0, 26: 88.0,
    27: 89.0, 28: 91.0, 29: 92.0, 30: 93.0, 31: 95.0, 32: 96.0,
    33: 97.0, 34: 99.0, 35: 100.0
}

# === Тексты для высоких и очень высоких факторов ===
FACTOR_TEXTS = {
    "financial": (
        "Респондент имеет высокий уровень мотивации к финансовым успехам. Это может быть обусловлено различными причинами: "
        "ориентация на получение дохода через достижение результатов, неудовлетворенность текущей материальной мотивацией, "
        "отсутствие прозрачности в системе материального вознаграждения и понимания основных принципов процесса, "
        "ощущение несправедливости в размере материального вознаграждения в сравнении с другими. "
        "Конкретную причину рекомендуется выяснять через очное интервью либо через проведение дополнительных, более глубинных исследований факторов мотивации."
    ),
    "recognition": (
        "Высокий уровень стремления Респондента к общественному признанию может быть обусловлен факторами внутренней мотивации на признание собственных результатов. "
        "Это может быть стремление к признанию достижений как публично так и индивидуально. В данном случае стоит избегать ситуаций размытия достижений, "
        "т.е. когда достижение в большей степени обеспечено Респондентом, но присваивается всей команде или тем, кто не участвовал в работе. "
        "Данный мотиватор стоит учесть в дальнейшем взаимодействии с Респондентом и учитывать в управлении, форме обратной связи. "
        "Стоит уделять внимание признанию результатов Респондента. Такой подход будет влиять на мотивацию Респондента положительно."
    ),
    "leadership_relations": (
# Модуль анализа результатов "Портрет Талантов"
# Тест 4: Мотивация — ПОЛНОЕ СООТВЕТСТВИЕ ТЗ (дословно)

from typing import List, Dict, Any

# === Шкала перевода баллов в проценты (0–35 баллов) ===
SCORE_TO_PERCENT = {
    0: 0.0, 1: 4.0, 2: 7.0, 3: 11.0, 4: 14.0, 5: 18.0, 6: 21.0, 7: 25.0,
    8: 30.0, 9: 35.0, 10: 40.0, 11: 45.0, 12: 50.0, 13: 56.0, 14: 63.0,
    15: 69.0, 16: 75.0, 17: 76.0, 18: 78.0, 19: 79.0, 20: 80.0,
    21: 82.0, 22: 83.0, 23: 84.0, 24: 86.0, 25: 87.0, 26: 88.0,
    27: 89.0, 28: 91.0, 29: 92.0, 30: 93.0, 31: 95.0, 32: 96.0,
    33: 97.0, 34: 99.0, 35: 100.0
}

# === Тексты для высоких и очень высоких факторов ===
FACTOR_TEXTS = {
    "financial": (
        "Респондент имеет высокий уровень мотивации к финансовым успехам. Это может быть обусловлено различными причинами: "
        "ориентация на получение дохода через достижение результатов, неудовлетворенность текущей материальной мотивацией, "
        "отсутствие прозрачности в системе материального вознаграждения и понимания основных принципов процесса, "
        "ощущение несправедливости в размере материального вознаграждения в сравнении с другими. "
        "Конкретную причину рекомендуется выяснять через очное интервью либо через проведение дополнительных, более глубинных исследований факторов мотивации."
    ),
    "recognition": (
        "Высокий уровень стремления Респондента к общественному признанию может быть обусловлен факторами внутренней мотивации на признание собственных результатов. "
        "Это может быть стремление к признанию достижений как публично так и индивидуально. В данном случае стоит избегать ситуаций размытия достижений, "
        "т.е. когда достижение в большей степени обеспечено Респондентом, но присваивается всей команде или тем, кто не участвовал в работе. "
        "Данный мотиватор стоит учесть в дальнейшем взаимодействии с Респондентом и учитывать в управлении, форме обратной связи. "
        "Стоит уделять внимание признанию результатов Респондента. Такой подход будет влиять на мотивацию Респондента положительно."
    ),
    "leadership_relations": (
cat > analyzer-portrait-of-talents/analyzer.py << 'EOF'
# Модуль анализа результатов "Портрет Талантов"
# Тест 4: Мотивация — ПОЛНОЕ СООТВЕТСТВИЕ ТЗ + ДОПОЛНИТЕЛЬНАЯ МЕТРИКА

from typing import List, Dict, Any

# === Шкала перевода баллов в проценты (0–35 баллов) ===
SCORE_TO_PERCENT = {
    0: 0.0, 1: 4.0, 2: 7.0, 3: 11.0, 4: 14.0, 5: 18.0, 6: 21.0, 7: 25.0,
    8: 30.0, 9: 35.0, 10: 40.0, 11: 45.0, 12: 50.0, 13: 56.0, 14: 63.0,
    15: 69.0, 16: 75.0, 17: 76.0, 18: 78.0, 19: 79.0, 20: 80.0,
    21: 82.0, 22: 83.0, 23: 84.0, 24: 86.0, 25: 87.0, 26: 88.0,
    27: 89.0, 28: 91.0, 29: 92.0, 30: 93.0, 31: 95.0, 32: 96.0,
    33: 97.0, 34: 99.0, 35: 100.0
}

# === Тексты для высоких и очень высоких факторов ===
FACTOR_TEXTS = {
    "financial": (
        "Респондент имеет высокий уровень мотивации к финансовым успехам. Это может быть обусловлено различными причинами: "
        "ориентация на получение дохода через достижение результатов, неудовлетворенность текущей материальной мотивацией, "
        "отсутствие прозрачности в системе материального вознаграждения и понимания основных принципов процесса, "
        "ощущение несправедливости в размере материального вознаграждения в сравнении с другими. "
        "Конкретную причину рекомендуется выяснять через очное интервью либо через проведение дополнительных, более глубинных исследований факторов мотивации."
    ),
    "recognition": (
        "Высокий уровень стремления Респондента к общественному признанию может быть обусловлен факторами внутренней мотивации на признание собственных результатов. "
        "Это может быть стремление к признанию достижений как публично так и индивидуально. В данном случае стоит избегать ситуаций размытия достижений, "
        "т.е. когда достижение в большей степени обеспечено Респондентом, но присваивается всей команде или тем, кто не участвовал в работе. "
        "Данный мотиватор стоит учесть в дальнейшем взаимодействии с Респондентом и учитывать в управлении, форме обратной связи. "
        "Стоит уделять внимание признанию результатов Респондента. Такой подход будет влиять на мотивацию Респондента положительно."
    ),
    "leadership_relations": (
        "Отношения с руководством является важным гигиеническим фактором мотивации для Респондента. Т.е. отсутствие прозрачных, рабочих, уважительных, конструктивных отношений может Респондента глубоко демотивировать. "
        "Авторитарный стиль управления, в котором тяжело проходят инициативы и приняты жесткие нормы коммуникаций также могут глубоко демотивировать Респондента, снижая его трудовую эффективность."
    ),
    "team_collaboration": (
        "Уровень важности для Респондента атмосферы сотрудничества и отношений в коллективе - высокий. Это означает, что Респондента может демотивировать рабочая среда в которой не определены границы ответственности и функциональные области деятельности, "
        "присутствует культура перекладывания ответственности и поиска виноватых, выделяются любимчики, либо приняты деструктивные, конфликтные способы решения рабочих вопросов."
    ),
    "responsibility": (
        "Уровень значимости ответственности Респондента за поручаемую работу является мотивирующим фактором для Респондента. Это означает, что Респондента мотивирует возможность принимать ответственные решения самостоятельно, "
        "иметь для этого определенные полномочия и доверие со стороны руководства. В том числе, выполнять работу, в результате которой появляются важные, значимые продукты деятельности для подразделения или компании."
    ),
    "career": (
        "Высокий уровень стремления к карьерному росту выражен как мотивирующий фактор. Респондента мотивирует понимание его карьерной лестницы и способов ее реализации. "
        "Это не обязательно получение новой должности. Может быть достаточно изменение статуса, полномочий, возможность получать дополнительное образование и со временем расширять границы функциональной деятельности. "
        "Более подробные причины рекомендуем выяснять в процессе личного взаимодействия и интервью."
    ),
    "achievement": (
        "Уровень стремления и мотивации к достижениям и личному успеху Респондента обозначен результатами исследования как высокий. Это означает, что Респондента мотивирует получение конкретных результатов, достижение поставленной цели. "
        "При работе с сотрудниками с таким вектором мотивации стоит следить, что бы задачи устанавливаемые перед ними были в большей степени достижимы. Если амбицию ставить слишком высокую с низкой вероятностью достижения - то повторяющиеся неудачи в достижении целей вызовут глубокую демотивацию Респондента "
        "и могут спровоцировать деструктивное или угнетенное состояние Респондента."
    ),
    "work_content": (
        "Содержание работы является для Респондента мотивирующим фактором. Это означает, что при взаимодействии с Респондентом стоит учитывать содержание поручаемой работы. "
        "Если доля задач, которая не вызывает у Респондента прямой заинтересованности высокая - это будет демотивировать Респондента и отрицательно сказываться на его результатах. "
        "Какое именно содержание работы вызывает у Респондента интерес стоит выяснять через личное взаимодействие, интервью или при постановке задач."
    )
}

# === Определение уровня выраженности и индикатора ===
def get_expression_level_and_indicator(percentage: float, is_motivational: bool) -> Dict[str, str]:
    if percentage <= 25.0:
        level = "низкий"
        indicator = "green" if not is_motivational else "red"
    elif percentage <= 50.0:
        level = "средний"
        indicator = "green" if not is_motivational else "yellow"
    elif percentage <= 75.0:
        level = "высокий"
        indicator = "yellow" if not is_motivational else "green"
    else:
        level = "очень высокий"
        indicator = "red" if not is_motivational else "green"
    return {"level": level, "indicator": indicator}

# === Тест 4: Мотивация ===
def calculate_motivation_scores(answers: List[Dict]) -> List[Dict]:
    # Собираем ответы: question_id -> значение
    q_mapping = {}
    for ans in answers:
        q_id = ans['question_id']
        val = ans['answer_value']
        if isinstance(val, dict):
            if 'value' in val:
                q_mapping[q_id] = val['value']
            elif 'score' in val:
                q_mapping[q_id] = val['score']
        elif isinstance(val, (int, float)):
            q_mapping[q_id] = val
        else:
            q_mapping[q_id] = 0

    # Гигиенические факторы
    financial = sum(q_mapping.get(q, 0) for q in [1, 8, 14, 15, 22, 23, 46])
    recognition = sum(q_mapping.get(q, 0) for q in [2, 9, 18, 19, 30, 36, 49])
    leadership_relations = sum(q_mapping.get(q, 0) for q in [3, 16, 32, 35, 40, 41, 5])
    team_collaboration = sum(q_mapping.get(q, 0) for q in [11, 20, 25, 31, 45, 51, 55])

    # Факторы мотивации
    responsibility = sum(q_mapping.get(q, 0) for q in [4, 13, 17, 26, 27, 33, 47])
    career = sum(q_mapping.get(q, 0) for q in [7, 28, 37, 42, 44, 50, 52])
    achievement = sum(q_mapping.get(q, 0) for q in [24, 29, 38, 39, 48, 53, 56])
    work_content = sum(q_mapping.get(q, 0) for q in [10, 12, 21, 34, 43, 54, 6])

    # Суммарные баллы
    total_hygiene = financial + recognition + leadership_relations + team_collaboration
    total_motivation = responsibility + career + achievement + work_content

    # Перевод в проценты
    hygiene_percent = min(round((total_hygiene / 140.0) * 100, 2), 100.0)
    motivation_percent = min(round((total_motivation / 140.0) * 100, 2), 100.0)

    # Определяем уровни для суммарных групп
    hygiene_level_info = get_expression_level_and_indicator(hygiene_percent, False)
    motivation_level_info = get_expression_level_and_indicator(motivation_percent, True)

    # Список факторов для сортировки
    hygiene_factors = [
        ("financial", financial, "Финансовые мотивы"),
        ("recognition", recognition, "Общественное признание"),
        ("leadership_relations", leadership_relations, "Отношение с руководством"),
        ("team_collaboration", team_collaboration, "Сотрудничество в коллективе")
    ]
    motivation_factors = [
        ("responsibility", responsibility, "Ответственность работы"),
        ("career", career, "Карьера - продвижение по службе"),
        ("achievement", achievement, "Достижение личного успеха"),
        ("work_content", work_content, "Содержание работы")
    ]

    # Сортируем по баллам (по убыванию)
    sorted_hygiene = sorted(hygiene_factors, key=lambda x: x[1], reverse=True)
    sorted_motivation = sorted(motivation_factors, key=lambda x: x[1], reverse=True)

    # Берём топ-2
    top_hygiene_1 = sorted_hygiene[0]
    top_hygiene_2 = sorted_hygiene[1] if len(sorted_hygiene) > 1 else ("", 0, "")
    top_motivation_1 = sorted_motivation[0]
    top_motivation_2 = sorted_motivation[1] if len(sorted_motivation) > 1 else ("", 0, "")

    results = []

    # Добавляем каждый фактор
    for key, score, name in hygiene_factors:
        percentage = SCORE_TO_PERCENT.get(score, 100.0)
        level_info = get_expression_level_and_indicator(percentage, False)
        results.append({
            "parameter_name": f"hygiene_{key}",
            "raw_score": score,
            "standardized_score": round(percentage, 2),
            "expression_level": level_info["level"],
            "indicator": level_info["indicator"],
            "interpretation_text": FACTOR_TEXTS.get(key, "Текст не найден.")
        })

    for key, score, name in motivation_factors:
        percentage = SCORE_TO_PERCENT.get(score, 100.0)
        level_info = get_expression_level_and_indicator(percentage, True)
        results.append({
            "parameter_name": f"motivation_{key}",
            "raw_score": score,
            "standardized_score": round(percentage, 2),
            "expression_level": level_info["level"],
            "indicator": level_info["indicator"],
            "interpretation_text": FACTOR_TEXTS.get(key, "Текст не найден.")
        })

    # Добавляем суммарные метрики
    results.append({
        "parameter_name": "total_hygiene_score",
        "raw_score": total_hygiene,
        "standardized_score": hygiene_percent,
        "expression_level": hygiene_level_info["level"],
        "indicator": hygiene_level_info["indicator"],
        "interpretation_text": f"Общий уровень гигиенических факторов: {hygiene_level_info['level']}"
    })

    results.append({
        "parameter_name": "total_motivation_score",
        "raw_score": total_motivation,
        "standardized_score": motivation_percent,
        "expression_level": motivation_level_info["level"],
        "indicator": motivation_level_info["indicator"],
        "interpretation_text": f"Общий уровень мотивационных факторов: {motivation_level_info['level']}"
    })

    # === НОВАЯ МЕТРИКА: Риск выгорания ===
    burnout_risk = "Низкий" if total_hygiene < total_motivation else "Высокий"
    burnout_indicator = "green" if burnout_risk == "Низкий" else "red"
    burnout_interpretation = (
        f"Риск выгорания: {burnout_risk}. "
        f"Гигиенические факторы: {total_hygiene}, Факторы мотивации: {total_motivation}. "
        f"Соотношение указывает на {'достаточный баланс' if burnout_risk == 'Низкий' else 'дисбаланс'}, "
        f"что может влиять на долгосрочную удовлетворённость работой."
    )

    results.append({
        "parameter_name": "burnout_risk",
        "raw_score": total_hygiene - total_motivation,
        "standardized_score": 0,
        "expression_level": burnout_risk,
        "indicator": burnout_indicator,
        "interpretation_text": burnout_interpretation
    })

    # Добавляем 8 полей отчёта
    report_fields = [
        {"field": "1", "value": top_hygiene_1[2]},
        {"field": "2", "value": FACTOR_TEXTS.get(top_hygiene_1[0], "Текст не найден.")},
        {"field": "3", "value": top_hygiene_2[2]},
        {"field": "4", "value": FACTOR_TEXTS.get(top_hygiene_2[0], "Текст не найден.")},
        {"field": "5", "value": top_motivation_1[2]},
        {"field": "6", "value": FACTOR_TEXTS.get(top_motivation_1[0], "Текст не найден.")},
        {"field": "7", "value": top_motivation_2[2]},
        {"field": "8", "value": FACTOR_TEXTS.get(top_motivation_2[0], "Текст не найден.")}
    ]

    for f in report_fields:
        results.append({
            "parameter_name": f"report_field_{f['field']}",
            "raw_score": 0,
            "standardized_score": 0,
            "expression_level": "report_field",
            "indicator": "white",
            "interpretation_text": f"{f['value']}"
        })

    return results
#####################################
################             ########
###############    ##################
##############    ###################
#############    ####################
############             ############
#####################     ###########
######################     ##########
####################      ###########
#########               #############
#####################################

cat > analyzer-portrait-of-talents/analyzer.py << 'EOF'
# Модуль анализа результатов "Портрет Талантов"
# Тест 5: IQ — ПОЛНОЕ СООТВЕТСТВИЕ ТЗ (дословно)

from typing import List, Dict, Any

# === Ключ правильных ответов ===
ANSWER_KEY = {
    "q1": [3],
    "q2": [3],
    "q3": [2],
    "q4": ["ДА", "да", "Да", "YES", "yes", "Yes"],
    "q5": [4],
    "q6": [2],
    "q7": [4],
    "q8": [1],
    "q9": [5],
    "q10": [40],
    "q11": [3],
    "q12": [270],
    "q13": [4],
    "q14": [3],
    "q15": [0.31],
    "q16": ["НИ", "ни", "Ни", "NO", "no", "No"],
    "q17": [4],
    "q18": [4],
    "q19": [3],
    "q20": ["Н", "н", "N", "n"],
    "q21": [3.5],
    "q22": [31],
    "q23": [2],
    "q24": [1],
    "q25": [1500],
    "q26": [1],
    "q27": [1],
    "q28": [1],
    "q29": [2, 13],  # Ответ: "2-13" или "2,13"
    "q30": [3],
    "q31": [1600],
    "q32": [1, 2, 4],
    "q33": [18],
    "q34": [3],
    "q35": [1],
    "q36": [1],
    "q37": [4.8],
    "q38": [1],
    "q39": [20],
    "q40": [1/8],
    "q41": [3],
    "q42": [14],
    "q43": [1],
    "q44": [800],
    "q45": [0.1],  # 1/10 = 0.1
    "q46": [280],
    "q47": [4.5],
    "q48": [1],
    "q49": [3],
    "q50": [17]
}

# === Субшкалы компетенций ===
SUBSCALES = {
    "awareness": ["q1", "q4", "q23"],  # Осведомленность
    "attention": ["q8", "q13"],        # Внимательность
    "spatial": ["q17", "q29", "q32", "q49"],  # Пространственные задачи
    "logic": ["q3", "q7", "q9", "q16"],       # Логические задачи
    "language": [
        "q2", "q5", "q6", "q11", "q14", "q19", "q20", "q21", "q24",
        "q26", "q28", "q30", "q34", "q35", "q36", "q38", "q41", "q43", "q47", "q48"
    ],  # Значения слов и фраз
    "math": [
        "q10", "q12", "q15", "q18", "q22", "q25", "q27", "q31", "q33", "q37",
        "q39", "q40", "q42", "q44", "q45", "q46", "q50"
    ]  # Математические задачи
}

# === Определение уровня интеллекта ===
def get_iq_level(percentage: float) -> str:
    if percentage <= 26.0:
        return "низкий"
    elif percentage <= 36.0:
        return "ниже среднего"
    elif percentage <= 48.0:
        return "средний"
    elif percentage <= 58.0:
        return "выше среднего"
    else:
        return "высокий"

# === Тест 5: IQ ===
def calculate_iq_scores(answers: List[Dict]) -> List[Dict]:
    # Собираем ответы: question_id -> answer_value
    q_mapping = {}
    for ans in answers:
        q_id = ans['question_id']
        val = ans['answer_value']
        if isinstance(val, dict):
            if 'value' in val:
                q_mapping[q_id] = val['value']
            elif 'score' in val:
                q_mapping[q_id] = val['score']
        else:
            q_mapping[q_id] = val

    results = []

    # Подсчитываем правильные ответы
    correct_count = 0
    for q_id, correct_answers in ANSWER_KEY.items():
        user_answer = q_mapping.get(q_id)

        # Обработка разных типов ответов
        is_correct = False
        if user_answer is None:
            is_correct = False
        elif isinstance(user_answer, str) and isinstance(correct_answers[0], str):
            is_correct = user_answer.strip() in [str(ca).strip() for ca in correct_answers]
        elif isinstance(user_answer, (int, float)) and isinstance(correct_answers[0], (int, float)):
            is_correct = abs(float(user_answer) - float(correct_answers[0])) < 1e-5
        elif isinstance(user_answer, list) and isinstance(correct_answers[0], list):
            # Для q29, q32: сравнение списков (независимо от порядка)
            user_sorted = sorted([int(x) for x in user_answer])
            correct_sorted = sorted([int(x) for x in correct_answers])
            is_correct = user_sorted == correct_sorted
        elif isinstance(user_answer, str) and ',' in user_answer:
            # Для q29, q32: если ответ строка "2,13"
            try:
                user_list = [int(x.strip()) for x in user_answer.split(',')]
                correct_list = [int(x) for x in correct_answers]
                is_correct = sorted(user_list) == sorted(correct_list)
            except:
                is_correct = False
        else:
            try:
                is_correct = float(user_answer) == float(correct_answers[0])
            except:
                is_correct = False

        if is_correct:
            correct_count += 1

    # Интегральный показатель IQ
    total_questions = 50
    iq_percentage = round((correct_count / total_questions) * 100, 2)
    iq_level = get_iq_level(iq_percentage)

    # Добавляем общий результат
    results.append({
        "parameter_name": "iq_total_score",
        "raw_score": correct_count,
        "standardized_score": iq_percentage,
        "expression_level": iq_level,
        "indicator": "green" if iq_level in ["выше среднего", "высокий"] else "yellow" if iq_level == "средний" else "red",
        "interpretation_text": f"Интегральный показатель уровня интеллекта: {iq_level} ({iq_percentage}% правильных ответов)"
    })

    # Подсчитываем по субшкалам
    for subscale_name, questions in SUBSCALES.items():
        total = len(questions)
        correct = 0
        missed = 0
        for q_id in questions:
            user_answer = q_mapping.get(q_id)
            if user_answer is None:
                missed += 1
                continue
            correct_answers = ANSWER_KEY.get(q_id, [])
            is_correct = False
            if isinstance(user_answer, str) and isinstance(correct_answers[0], str):
                is_correct = user_answer.strip() in [str(ca).strip() for ca in correct_answers]
            elif isinstance(user_answer, (int, float)) and isinstance(correct_answers[0], (int, float)):
                is_correct = abs(float(user_answer) - float(correct_answers[0])) < 1e-5
            elif isinstance(user_answer, list):
                try:
                    user_list = [int(x) for x in user_answer]
                    correct_list = [int(x) for x in correct_answers]
                    is_correct = sorted(user_list) == sorted(correct_list)
                except:
                    is_correct = False
            elif isinstance(user_answer, str) and ',' in user_answer:
                try:
                    user_list = [int(x.strip()) for x in user_answer.split(',')]
                    correct_list = [int(x) for x in correct_answers]
                    is_correct = sorted(user_list) == sorted(correct_list)
                except:
                    is_correct = False
            else:
                try:
                    is_correct = float(user_answer) == float(correct_answers[0])
                except:
                    is_correct = False
            if is_correct:
                correct += 1

        incorrect = total - correct - missed

        # Добавляем метрики по субшкале
        results.append({
            "parameter_name": f"iq_subscale_{subscale_name}",
            "raw_score": correct,
            "standardized_score": round((correct / total) * 100, 2) if total > 0 else 0.0,
            "expression_level": "subscale",
            "indicator": "white",
            "interpretation_text": (
                f"Субшкала: {subscale_name}. "
                f"Всего вопросов: {total}, Верно: {correct}, Неверно: {incorrect}, Пропущено: {missed}"
            )
        })

    return results

# === Основная функция анализа ===
def analyze(assignment_id: int, answers: List[Dict]) -> List[Dict]:
    # Сначала Тест 1 (P, A, E, I)
    results = calculate_paei_scores(answers)
    # Затем Тест 2 (Эмоциональный интеллект)
    results.extend(calculate_emotional_intelligence_scores(answers))
    # Теперь Тест 3 (Командные роли)
    results.extend(calculate_team_roles_scores(answers))
    # И наконец — Тест 4 (Мотивация)
    results.extend(calculate_motivation_scores(answers))
    # Добавляем Тест 5 (IQ)
    results.extend(calculate_iq_scores(answers))
    return results